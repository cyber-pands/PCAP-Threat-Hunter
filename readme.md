# PCAPThreatHunter

PCAPThreatHunter is a Python-based tool designed to process network traffic data from `.pcap` files, analyze logs generated by Zeek, and extract Indicators of Compromise (IOCs) for threat intelligence. This tool automates the process of analyzing network logs and querying threat intelligence APIs to classify IOCs as malicious or benign.

---

## Features

- **Zeek Integration**: Processes `.pcap` files using Zeek to generate network logs.
- **Log Conversion**: Converts Zeek log files from JSON to CSV format for easier processing.
- **IOC Extraction**: Extracts IOCs such as IPs, domains, URLs, and hashes from the logs.
- **Threat Intelligence**: Queries multiple threat intelligence APIs (e.g., AbuseIPDB, AlienVault OTX) to classify IOCs.
- **Redis Integration**: Caches IOC results in Redis for faster lookups.
- **Modular Design**: Organized into reusable modules for better maintainability.

---

## Project Structure

```
PCAPThreatHunter/
├── modules/
│   ├── ioc_extractor.py       # Module for extracting IOCs from logs
│   ├── message_log.py         # Module for logging success, failure, and informational messages
│   └── threat_intel.py        # Module for querying threat intelligence APIs
├── zeek_logs/                 # Folder for storing Zeek-generated logs
├── extracted_iocs.csv         # File containing extracted IOCs (generated dynamically)
├── main.py                    # Main script to run PCAPThreatHunter
├── requirements.txt           # Python dependencies
└── README.md                  # Project documentation
```

---

## Requirements

- Python 3.8 or higher
- Zeek (formerly Bro) installed on the system
- Redis server running locally
- API keys for:
  - AbuseIPDB
  - AlienVault OTX
  - Abuse.ch ThreatFox

---

## Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/your-repo/PCAPThreatHunter.git
   cd PCAPThreatHunter
   ```

2. Install the required Python dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Ensure Zeek is installed and accessible from the command line:
   ```bash
   which zeek
   ```

4. Start the Redis server:
   ```bash
   redis-server
   ```

5. Add your API keys to a file named `api_keys.py` in the `modules` directory:
   ```python
   # modules/api_keys.py
   abuseIPdb_api_key = "your_abuseipdb_api_key"
   alien_vault_otx_api_key = "your_alienvault_otx_api_key"
   abusech_api_key = "your_abusech_api_key"
   ```

---

## Usage

Run the main script with a `.pcap` file as input:
```bash
python main.py -r <path_to_pcap_file>
```

The script will:
1. Process the `.pcap` file using Zeek.
2. Convert the generated logs into CSV format.
3. Extract IOCs from the logs.
4. Query threat intelligence APIs to classify IOCs.
5. Save the results in `extracted_iocs.csv`.

---

## Modules

### 1. `ioc_extractor.py`
- Extracts IOCs (IPs, domains, URLs, hashes) from Zeek-generated logs.
- Saves the extracted IOCs to `extracted_iocs.csv`.

### 2. `message_log.py`
- Provides utility functions for logging success, failure, and informational messages with colored output.

### 3. `threat_intel.py`
- Queries threat intelligence APIs (AbuseIPDB, AlienVault OTX, Abuse.ch ThreatFox) to classify IOCs.
- Caches results in Redis for faster lookups.

---

## Example Workflow

1. **Input**: A `.pcap` file containing network traffic data.
2. **Processing**:
   - Zeek processes the `.pcap` file and generates logs.
   - Logs are converted from JSON to CSV format.
   - IOCs are extracted from the logs.
3. **Threat Intelligence**:
   - Extracted IOCs are queried against threat intelligence APIs.
   - Results are cached in Redis and saved to `extracted_iocs.csv`.
4. **Output**: A CSV file containing classified IOCs with threat labels.

---

## Dependencies

### Python Libraries:
- `argparse`
- `pandas`
- `redis`
- `requests`
- `pyfiglet`
- `termcolor`

### External Tools:
- Zeek
- Redis

---

## Troubleshooting

### Zeek Not Found:
- Ensure Zeek is installed and added to your system's PATH.
- Run `which zeek` to verify.

### Redis Not Running:
- Start the server using `redis-server`.

### API Key Errors:
- Ensure valid API keys are added to `api_keys.py`.

### File Not Found:
- Ensure the `.pcap` file exists and the path is correct.

---

## Future Enhancements

- Add support for additional threat intelligence APIs.
- Implement multi-threading for faster processing.
- Add a web-based interface for easier interaction.

---

## License

This project is licensed under the MIT License. See the LICENSE file for details.

---

## Author

Developed by **cyber-pands**.